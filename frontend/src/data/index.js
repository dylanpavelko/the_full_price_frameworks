/**
 * Data loading utilities for The Full Price frontend.
 * 
 * In production, these JSON files are generated by the Django backend
 * using the StaticDataExporter. This allows the entire site to be hosted
 * as static files without a server.
 */

/**
 * Load all products from the static data export
 * @returns {Promise<Array>} Array of product objects with impact data
 */
export async function loadProducts() {
  try {
    const response = await fetch('/data/products.json');
    if (!response.ok) {
      throw new Error('Failed to load products');
    }
    const data = await response.json();
    return data.products || [];
  } catch (error) {
    console.error('Error loading products:', error);
    return [];
  }
}

/**
 * Load all posts from the static data export
 * @returns {Promise<Array>} Array of post objects
 */
export async function loadPosts() {
  try {
    const response = await fetch('/data/posts.json');
    if (!response.ok) {
      throw new Error('Failed to load posts');
    }
    const data = await response.json();
    return data.posts || [];
  } catch (error) {
    console.error('Error loading posts:', error);
    return [];
  }
}

/**
 * Load a single post by slug
 * @param {string} slug - The post slug
 * @returns {Promise<Object>} Post object
 */
export async function loadPostBySlug(slug) {
  try {
    const response = await fetch(`/data/posts/${slug}.json`);
    if (!response.ok) {
      throw new Error('Failed to load post');
    }
    const data = await response.json();
    return data.post;
  } catch (error) {
    console.error(`Error loading post ${slug}:`, error);
    return null;
  }
}

/**
 * Load a single product by slug
 * @param {string} slug - The product slug
 * @returns {Promise<Object|null>} Product object or null if not found
 */
export async function loadProductBySlug(slug) {
  const products = await loadProducts();
  return products.find(p => p.slug === slug) || null;
}
